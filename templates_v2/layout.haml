- load i18n
- load assets
- load staticfiles

- get_current_language as LANGUAGE_CODE
- get_current_language_bidi as LANGUAGE_BIDI

!!! 5
%html.no-js{lang:"#{LANGUAGE_CODE}", dir: "{% if LANGUAGE_BIDI %}rtl{% else %}ltr{% endif %}"}
  %head
    %meta{charset: "utf-8"}
    %meta{'http-equiv': "X-UA-Compatible", content: "IE=edge"}
    %meta{name: "viewport", content: "width=device-width, maximum-scale=1, user-scalable=no"}
    - if user_ios_mobile_app_id
      %meta{name: "apple-itunes-app", content: "app-id={{user_ios_mobile_app_id}}"}
    - block meta
    - block page_title
      %title McKinsey Academy
      %meta{property: "og:title", content: "McKinsey Academy"}

    - block page_description
      %meta{name: "description", content: "{% trans 'McKinsey Academy helps organizations thrive by accelerating their talent advantage' %}"}
      %meta{property: "og:description", content: "{% trans 'McKinsey Academy helps organizations thrive by accelerating their talent advantage' %}"}

    %script{src: "{% static 'js/css-vars-ponyfill.js' %}"}

    {% assets "css_core_v2" %}
      %link.pony{rel: "stylesheet", href: "{{ ASSET_URL }}"}
    {% endassets %}


    %script
      var primary = null;

    -if client_customization.hex_course_title
      :css
        :root{
          --primary: {{client_customization.hex_course_title}};
          --header-top: {{client_customization.hex_course_title}};
          --secondary: {{client_customization.hex_course_title}};
        }
      %script
        var primary = "{{client_customization.hex_course_title}}";
        var secondary = "{{client_customization.hex_course_title}}";
        var header_top = "{{client_customization.hex_course_title}}";

    -if client_customization.hex_background_bar
      :css
        :root{
          --header-top: {{client_customization.hex_background_bar}};
          --secondary: {{client_customization.hex_background_bar}};
        }

      %script
        var secondary = "{{client_customization.hex_background_bar}}";
        var header_top = "{{client_customization.hex_background_bar}}";


    %script
      var variables = {}
      if (primary !== null){
        variables = {
          '--primary': primary,
          '--secondary': secondary,
          '--header-top': header_top
          };
      }
      cssVars({
        onlyVars: true,
        include: 'link.pony',
        variables: variables
      });

    - block open_graph
      %meta{property: "og:site_name", content: "{% trans 'McKinsey Academy' %}"}
      %meta{property: "og:image", content: "/static/image/McKA_OG.png"}

    -# favicon
    %link{rel: "shortcut icon", href: "/static/favicons/favicon.ico?s=#{session_id}"}
    %link{rel: "apple-touch-icon", sizes: "57x57", href: "/static/favicons/apple-touch-icon-57x57.png?s=#{session_id}"}
    %link{rel: "apple-touch-icon", sizes: "114x114", href: "/static/favicons/apple-touch-icon-114x114.png?s=#{session_id}"}
    %link{rel: "apple-touch-icon", sizes: "72x72", href: "/static/favicons/apple-touch-icon-72x72.png?s=#{session_id}"}
    %link{rel: "apple-touch-icon", sizes: "144x144", href: "/static/favicons/apple-touch-icon-144x144.png?s=#{session_id}"}
    %link{rel: "apple-touch-icon", sizes: "60x60", href: "/static/favicons/apple-touch-icon-60x60.png?s=#{session_id}"}
    %link{rel: "apple-touch-icon", sizes: "120x120", href: "/static/favicons/apple-touch-icon-120x120.png?s=#{session_id}"}
    %link{rel: "apple-touch-icon", sizes: "76x76", href: "/static/favicons/apple-touch-icon-76x76.png?s=#{session_id}"}
    %link{rel: "apple-touch-icon", sizes: "152x152", href: "/static/favicons/apple-touch-icon-152x152.png?s=#{session_id}"}
    %link{rel: "apple-touch-icon", sizes: "180x180", href: "/static/favicons/apple-touch-icon-180x180.png?s=#{session_id}"}
    %link{rel: "icon", type: "image/png", href: "/static/favicons/favicon-192x192.png?s=#{session_id}", sizes: "192x192"}
    %link{rel:"icon", type:"image/png", href: "/static/favicons/favicon-160x160.png?s=#{session_id}", sizes: "160x160"}
    %link{rel:"icon", type:"image/png", href: "/static/favicons/favicon-96x96.png?s=#{session_id}", sizes: "96x96"}
    %link{rel:"icon", type:"image/png", href: "/static/favicons/favicon-16x16.png?s=#{session_id}", sizes: "16x16"}
    %link{rel:"icon", type:"image/png", href: "/static/favicons/favicon-32x32.png?s=#{session_id}", sizes: "32x32"}
    %meta{name: "msapplication-TileColor", content: "#2b5797"}
    %meta{name: "msapplication-TileImage", content: "/static/favicons/mstile-144x144.png"}
    %meta{name: "msapplication-config", content: "/static/favicons/browserconfig.xml"}
    -# android smart app banner manifest json file
    - if user_android_mobile_app_id
      %link{rel:"manifest", href: "/static/android_app_banner_manifest_files/manifest{{user_organization_id}}.json"}
    -# CSS
    - if not request.is_IE8
      %link{href: 'https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,700', rel: 'stylesheet', type: 'text/css'}

    %link{:href => "https://fonts.googleapis.com/icon?family=Material+Icons", :rel => "stylesheet"}

    - block css
      %link{rel: "stylesheet", href: "//player.ooyala.com/static/v4/stable/4.32.8/skin-plugin/html5-skin.css"}
    - if xblock_theme_css_path
      %link{rel: "stylesheet", href: "{% static xblock_theme_css_path %}"}
      %link{rel: "stylesheet", href: "{% static 'css/cropper.css' %}"}


    - if LANGUAGE_BIDI
      {% assets "scss_rtl_v2" %}
        %link{rel: "stylesheet", href: "{{ ASSET_URL }}"}
      {% endassets %}
    - else
      {% assets "scss_ltr_v2" %}
        %link{rel: "stylesheet", href: "{{ ASSET_URL }}"}
      {% endassets %}

    -# Custom head JS
    - block head_js

    - if ga_tracking_id
      %script
        if(window.location.href.indexOf("mckinseyacademy.com") > -1) {
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
            ga('create', '{{ ga_tracking_id }}', 'mckinseyacademy.com');
            ga('send', 'pageview');
        } else {
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
            ga('create', '{{ ga_tracking_id }}', 'auto');
            ga('send', 'pageview');
        }
        ga('set', 'transport', 'beacon');

        - if request.user.is_authenticated
          document.addEventListener("DOMContentLoaded", function() {
            window.hashedUserId = 'u:' + $.md5('#{request.user.username}').slice(-20);
            ga('send', 'pageview', {
              'dimension1': '#{request.user.id}',
              'dimension4': window.hashedUserId,
            });
          });

          - if organization_id
            ga('send', 'pageview', {
              'dimension2': '#{organization_id}'
            })

          - if course_name
            ga('send', 'pageview', {
              'dimension3': '#{course_name}'
            })
    - else
      :javascript
        // Stub ga function so ga(...) can be used while testing
        function ga(arg) {
          console.group("Analytics Event:");
          console.table(arguments);
          console.groupEnd();
          if(typeof arg === "function") {
            arg();
          }
        }

    -# Override if you need another version of jQuery
    - block jquery
      %script{src: "{% static 'js/jquery-1.11.2.min.js' %}"}

    -# edx-notifications script dependencies
    - block edx_notifications
      %script{src: "/static/js/vendor/underscore.js"}
      %script{src: "/static/js/vendor/backbone.js"}
      %script{src: "/static/js/vendor/date.js"}
    -# custom js libs
    - block custom_js

    %script{src: "https://use.fontawesome.com/a0a3a578ff.js"}

    -# custom css scripts
    - block custom_css

    %script
      $(document).ready(function() {
        /* Disable Log in button on mobile */
        $(".with-program .login-btn").attr("href", "javascript:void(0)");

        /* if in an iframe, set referrer url into a cookie */
        if(parent !== window){
          $.cookie('referrer_url', document.referrer);
        }
      });

    %script
      window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=(r?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+e+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","resetIdentity","removeEventProperty","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
      heap.load('#{heap_app_id}');

  %body.new-theme{
    id: "{% if '/admin' in request.path %}admin-body{% endif %}",
    class: "site-wrapper {% if LANGUAGE_BIDI %}rtl{% else %}ltr{% endif %} {% if program %}with-program {% endif %} {% if request.is_IE8 %}ie8{% endif %} {% block body_class %}{% if is_full_screen %}zoomIn{% endif %}{% endblock %}",
    style: "{% if client_customization %}{%if client_customization.hex_page_background %}background-color:#{client_customization.hex_page_background};{% endif %}{%if client_customization.client_background %}background-image:url(#{client_customization.client_background});{% endif %}{%if client_customization.client_background_css%}#{client_customization.client_background_css}{% endif %}{% endif %}"
  }
    - block help_context

    -# Header
    - block header
      - include 'header.haml'

    -# Main content goes here
    %main.fadeIn.animated.delay-2s{role: "main"}
      - block navigation_content
      - block content

    -# Footer
    - block footer
      - include 'footer.haml'

    -# i18n JS Catalog
    - block i18n
      %script{type: "text/javascript", src: "{% url 'javascript-catalog' %}"}

    -# jQuery-cookie
    - block jquery_cookie
      %script{src: "{% static 'js/vendor/jquery.cookie.js' %}"}

    -# jQuery-xblock
    - block jquery_xblock
      %script{src: "{% static 'js/vendor/jquery.xblock.js' %}"}

    -# Bootstrap JS
    - block bootstrap_js
      %script{src: "{% static 'js/bootstrap.bundle.min.js' %}"}

    - block %jquery_validation
      %script{src: "{% static 'https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.8.1/jquery.validate.js' %}"}

    -# JS - custom snippets
    - block js_snippets

    - block edit_full_name_modal
      .modal.middleSize.noTopBorder.fade.editProfileField#editFullName{:aria-hidden => "true", :aria-labelledby => "myLargeModalLabel", :role => "dialog", :tabindex => "-1"}
        .modal-dialog
          .modal-content
            .modal-header
              .col
                %h4.modal-title
                  {% trans "Enter your full name" %}
              %button.close{:aria-label => "Close", :data-dismiss => "modal", :type => "button"}
                %span{:aria-hidden => "true"} ×
            .modal-body
              %form.white.clearfix{action: "/accounts/edit_fullname/", method:"POST"}
                - csrf_token
                .form-group
                  %label.form-label{:for => "exampleInputEmail1"}
                    {% trans "First name" %}
                  %input.form-control.form-input{:aria-describedby => "emailHelp", :placeholder => "", :type => "text", :name => "first_name"}/
                .form-group
                  %label.form-label{:for => "exampleInputEmail1"}
                    {% trans "Last name" %}
                  %input.form-control.form-input{:aria-describedby => "emailHelp", :placeholder => "", :type => "text", :name => "last_name"}/
                .invalid-feedback.error.mb-4
                %div3
                  %button.btn.btn-primary.mt-20.ome.dome-bc{:type => "submit"}
                    {% trans "Save" %}

    - block edit_title_modal
      .modal.middleSize.noTopBorder.fade.editProfileField#editRole{:aria-hidden => "true", :aria-labelledby => "myLargeModalLabel", :role => "dialog", :tabindex => "-1"}
        .modal-dialog
          .modal-content
            .modal-header
              .col
                %h4.modal-title
                  {% trans "Enter your title" %}
              %button.close{:aria-label => "Close", :data-dismiss => "modal", :type => "button"}
                %span{:aria-hidden => "true"} ×
            .modal-body
              %form.white.clearfix{:method => "POST", :action => "/accounts/edit_title/"}
                - csrf_token
                .form-group
                  %label.form-label{:for => "exampleInputEmail1"}
                    {% trans "Title" %}
                  %input.form-control.form-input{:aria-describedby => "emailHelp", :placeholder => "", :type => "text", :name => "title"}/

                .invalid-feedback.error.mb-4
                %button.btn.btn-primary.mt-10.ome.dome-bc{:type => "submit"}
                  {% trans "Save" %}

    - block edit_photo_modal
      - include "accounts/user_profile.haml"
    #generalModal.modal.fade{:role => "dialog"}
      .modal-dialog
        .modal-content
          .modal-header
            %button.close{:data-dismiss => "modal", :type => "button"} ×
            %h4.modal-title Modal Header
          .modal-body
            %p Some text in the modal.
          .modal-footer
            %button.btn.btn-default{:data-dismiss => "modal", :type => "button"} Close

    - block messages_modal
      - if messages
        #messagesModal.modal.fade{:tabindex => "-1", :role => "dialog", :aria-hidden => "true"}
          .modal-dialog{:role => "document"}
            .modal-content
              .modal-header
                %button.close{:type => "button", :data-dismiss => "modal", :aria-label => "close"}
                  %span{:aria-hidden => "true"} &times;
                %h5.modal-title {% trans "Notice" %}
              .modal-body
                {% for message in messages %}
                  {{ message }}<br/>
                {% endfor %}

        %script
          if ($("#messagesModal").length){
            setTimeout(function () {
              $('#messagesModal').modal('show')
            }, 10);
          }

    / New Feature Tour Structure
    .modal.fade.newFeatureTour.in.show{:aria-hidden => "true", :aria-labelledby => "myLargeModalLabel", :role => "dialog", :tabindex => "-1"}
      .modal-dialog.modal-lg
        .modal-content
          .modal-body
            %button.close.btn-skip{:aria-label => "Close", :data-dismiss => "modal", :type => "button"}
              %span{:aria-hidden => "true"} {% trans 'Skip'%}
            .sliderWraper
              #demo.carousel.slide{:data-ride => "carousel", :data-pause => "hover"}

                / The slideshow
                .carousel-inner
                  .carousel-item.active
                    .featureImage
                      .holder
                        %img{:alt => "", :height => "", :src => "static/image/newUiTour/McKA-UI-Refresh_Comm-Graphic.png", :width => "600"}
                    .featureContent
                      .holder
                        .head
                          %h2 {%trans 'Your learning experience has a fresh look!' %}
                        .contentHolder
                          %p {% trans 'The new design makes it easier for you to navigate, understand your progress and stay focused on your learning.'%}
                  .carousel-item
                    .featureImage
                      .holder
                        %img{:alt => "", :height => "", :src => "static/image/newUiTour/McKA-UI-Refresh_Comm-Graphic4.png", :width => "600"}
                    .featureContent
                      .holder
                        .head
                          %h2 {% trans 'Navigating is simple'%}
                        .contentHolder
                          %p {% trans 'The updated landing page makes it easier for you to access your programs or courses.'%}
                  .carousel-item
                    .featureImage
                      .holder
                        %img{:alt => "", :height => "", :src => "static/image/newUiTour/McKA-UI-Refresh_Comm-Graphic3.png", :width => "600"}
                    .featureContent
                      .holder
                        .head
                          %h2 {% trans 'New full-screen mode'%}
                        .contentHolder
                          %p {% trans 'In your course, you can now zoom into the content by choosing full screen mode.'%}
                  .carousel-item
                    .featureImage
                      .holder
                        %img{:alt => "", :height => "", :src => "static/image/newUiTour/McKA-UI-Refresh_Comm-Graphic2.png", :width => "600"}
                    .featureContent
                      .holder
                        .head
                          %h2 {% trans 'Access from any device'%}
                        .contentHolder
                          %p {% trans 'The designs have been optimized for all devices so you can learn from anywhere.'%}
                  .carousel-item
                    .featureImage
                      .holder
                        %img{:alt => "", :height => "", :src => "static/image/newUiTour/McKA-UI-Refresh_Comm-Graphic5.png", :width => "600"}
                    .featureContent
                      .holder
                        .head
                          %h2 {% trans 'No interruption to your learning'%}
                        .contentHolder
                          %p {% trans 'Pick up where you left off! Your progress and the content in the courses is not impacted by this change.'%}

                / Left and right controls
                .controlsWrap
                  / Indicators
                  %ul.carousel-indicators
                    %li.active{:data-slide-to => "0", :data-target => "#demo"}
                    %li{:data-slide-to => "1", :data-target => "#demo"}
                    %li{:data-slide-to => "2", :data-target => "#demo"}
                    %li{:data-slide-to => "3", :data-target => "#demo"}
                    %li{:data-slide-to => "4", :data-target => "#demo"}
                  %a.carousel-control-prev{:data-slide => "prev", :href => "#demo"}
                    %span.carousel-control-prev-icon
                      %i.material-icons keyboard_arrow_left
                  %a.carousel-control-next{:data-slide => "next", :href => "#demo"}
                    %span.carousel-control-next-icon
                      %i.material-icons keyboard_arrow_right
    -if show_new_ui_tour
      %script{src: "{% static 'js/new_ui_tour.js' %}"}

    %script{src: "{% static 'js/shader.js' %}"}
    %script
      var root = document.documentElement;
      var secondary = root.style.getPropertyValue("--secondary");
      var primary = root.style.getPropertyValue("--primary");
      if (secondary) {
        root.style.setProperty('--branding-lightened-color', lighten(secondary, 65));
      } else if (primary) {
        root.style.setProperty('--branding-lightened-color', lighten(primary, 65));
      } else {
        root.style.setProperty('--branding-lightened-color', lighten("#0093d3", 90));
      }

    -# Ooyala Player JS
    - block ooyala_player
      - if not do_not_load_ooyala
        -# locally hosted ooyala core file customized to include pcode & brandingid
        %script{src: "{% static 'js/vendor/ooyala/ooyala_core_4.32.8.js' %}"}
        %script{src: "//player.ooyala.com/static/v4/stable/4.32.8/skin-plugin/html5-skin.min.js"}
        %script{src: "//player.ooyala.com/static/v4/stable/4.32.8/video-plugin/main_html5.min.js"}
        %script{src: "//player.ooyala.com/static/v4/stable/4.32.8/video-plugin/bit_wrapper.min.js"}

    -# Custom JS
    - block body_js
      {% assets "js_all_v2" %}
        %script{src: "{{ ASSET_URL }}"}
      {% endassets %}

    - if xblock_theme_js_path
      %script{src: "{% static xblock_theme_js_path %}"}
    -# Session Timeout
    %script
      var apros_session_timeout_seconds = {{apros_session_timeout_seconds}};
    %script{src:"static/js/session_timeout_timer.js"}
    %script{src: "{% static 'js/image_editor.js' %}"}
    %script{src: "{% static 'js/vendor/cropper.min.js' %}"}
