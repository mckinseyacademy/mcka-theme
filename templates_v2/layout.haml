- load i18n
- load assets
- load staticfiles
- load statici18n

- get_current_language as LANGUAGE_CODE
- get_current_language_bidi as LANGUAGE_BIDI

{% load template_helpers %}

!!! 5
%html.no-js{lang:"#{LANGUAGE_CODE}", dir: "{% if LANGUAGE_BIDI %}rtl{% else %}ltr{% endif %}"}
  %head
    %meta{charset: "utf-8"}
    %meta{'http-equiv': "X-UA-Compatible", content: "IE=edge"}
    %meta{name: "viewport", content: "width=device-width, maximum-scale=1, user-scalable=no"}
    - block meta
    - block page_title
      %title Academy
      %meta{property: "og:title", content: "Academy"}

    - block page_description
      %meta{name: "description", content: "{% trans 'McKinsey Academy helps organizations thrive by accelerating their talent advantage' %}"}
      %meta{property: "og:description", content: "{% trans 'McKinsey Academy helps organizations thrive by accelerating their talent advantage' %}"}

    %script{src: "{% static 'js/css-vars-ponyfill.js' %}"}

    :css
      :root{
        {% for key, value in branding_colors.items %}
          --{{key}}: {{value}} !important;
        {% endfor %}
      }

    %script
      {% for key, value in branding_colors.items %}
        var {{key|clean_key}} = "{{value}}";
      {% endfor %}

    {% assets "css_core_v2" %}
      %link.pony{rel: "stylesheet", href: "{{ ASSET_URL }}"}
    {% endassets %}

    %script
      var variables = {{branding_colors | safe}};
      cssVars({
        onlyVars: true,
        include: 'link.pony',
        variables: variables,
        watch: true
      });


    %script
      var variables = {}
      if (primary !== null){
        variables = {
          '--primary': primary,
          '--secondary': secondary,
          '--header-top': header_top
          };
      }
      cssVars({
        onlyVars: true,
        include: 'link.pony',
        variables: variables,
        watch: true
      });

    - block open_graph
      %meta{property: "og:site_name", content: "{% trans 'McKinsey Academy' %}"}
      %meta{property: "og:image", content: "{% static 'image/McKA_OG.png' %}"}

    -# favicon
    %link{rel: "shortcut icon", href: "{% static 'favicons/favicon.ico' %}"}
    %link{rel: "apple-touch-icon", sizes: "57x57", href: "{% static 'favicons/apple-touch-icon-57x57.png' %}"}
    %link{rel: "apple-touch-icon", sizes: "114x114", href: "{% static 'favicons/apple-touch-icon-114x114.png' %}"}
    %link{rel: "apple-touch-icon", sizes: "72x72", href: "{% static 'favicons/apple-touch-icon-72x72.png' %}"}
    %link{rel: "apple-touch-icon", sizes: "144x144", href: "{% static 'favicons/apple-touch-icon-144x144.png' %}"}
    %link{rel: "apple-touch-icon", sizes: "60x60", href: "{% static 'favicons/apple-touch-icon-60x60.png' %}"}
    %link{rel: "apple-touch-icon", sizes: "120x120", href: "{% static 'favicons/apple-touch-icon-120x120.png' %}"}
    %link{rel: "apple-touch-icon", sizes: "76x76", href: "{% static 'favicons/apple-touch-icon-76x76.png' %}"}
    %link{rel: "apple-touch-icon", sizes: "152x152", href: "{% static 'favicons/apple-touch-icon-152x152.png' %}"}
    %link{rel: "apple-touch-icon", sizes: "180x180", href: "{% static 'favicons/apple-touch-icon-180x180.png' %}"}
    %link{rel: "icon", type: "image/png", href: "{% static 'favicons/favicon-192x192.png' %}", sizes: "192x192"}
    %link{rel:"icon", type:"image/png", href: "{% static 'favicons/favicon-160x160.png' %}", sizes: "160x160"}
    %link{rel:"icon", type:"image/png", href: "{% static 'favicons/favicon-96x96.png' %}", sizes: "96x96"}
    %link{rel:"icon", type:"image/png", href: "{% static 'favicons/favicon-16x16.png' %}", sizes: "16x16"}
    %link{rel:"icon", type:"image/png", href: "{% static 'favicons/favicon-32x32.png' %}", sizes: "32x32"}
    %meta{name: "msapplication-TileColor", content: "#2b5797"}
    %meta{name: "msapplication-TileImage", content: "{% static 'favicons/mstile-144x144.png' %}"}
    %meta{name: "msapplication-config", content: "{% static 'favicons/browserconfig.xml' %}"}
    -# CSS
    - if not request.is_IE8
      %link{href: 'https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,700', rel: 'stylesheet', type: 'text/css'}

    - block css
    - if xblock_theme_css_path
      %link.pony{rel: "stylesheet", href: "{% static xblock_theme_css_path %}"}
      %link{rel: "stylesheet", href: "{% static 'css/cropper.css' %}"}


    - if LANGUAGE_BIDI
      {% assets "css_rtl_v2" %}
        %link{rel: "stylesheet", href: "{{ ASSET_URL }}"}
      {% endassets %}
    - else
      {% assets "css_ltr_v2" %}
        %link{rel: "stylesheet", href: "{{ ASSET_URL }}"}
      {% endassets %}

    -# Custom head JS
    - block head_js
      -# Override if you need another version of jQuery
      - block jquery
        %script{src: "//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.2/jquery.min.js"}

      - block underscore
        %script{src: "//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"}

      - block i18n
        %script{type: "text/javascript", src: "{% statici18n LANGUAGE_CODE %}"}

      {% assets "js_all_v2" %}
        %script{src: "{{ ASSET_URL }}"}
      {% endassets %}

    - if ga_tracking_id
      %script
        if(window.location.href.indexOf("mckinseyacademy.com") > -1) {
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
            ga('create', '{{ ga_tracking_id }}', 'mckinseyacademy.com');
            ga('send', 'pageview');
        } else {
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
            ga('create', '{{ ga_tracking_id }}', 'auto');
            ga('send', 'pageview');
        }
        ga('set', 'transport', 'beacon');

        - if request.user.is_authenticated
          document.addEventListener("DOMContentLoaded", function() {
            window.hashedUserId = 'u:' + $.md5('#{request.user.username}').slice(-20);
            ga('send', 'pageview', {
              'dimension1': '#{request.user.id}',
              'dimension4': window.hashedUserId,
            });
          });

          - if organization_id
            ga('send', 'pageview', {
              'dimension2': '#{organization_id}'
            })

          - if course_name
            ga('send', 'pageview', {
              'dimension3': '#{course_name}'
            })
    - else
      :javascript
        // Stub ga function so ga(...) can be used while testing
        function ga(arg) {
          console.group("Analytics Event:");
          console.table(arguments);
          console.groupEnd();
          if(typeof arg === "function") {
            arg();
          }
        }

    -# custom js libs
    - block custom_js

    %script{src: "https://use.fontawesome.com/a0a3a578ff.js"}

    -# custom css scripts
    - block custom_css

    %script
      $(document).ready(function() {
        /* Disable Log in button on mobile */
        $(".with-program .login-btn").attr("href", "javascript:void(0)");

        /* if in an iframe, set referrer url into a cookie */
        if(parent !== window){
          $.cookie('referrer_url', document.referrer);
        }
      });

    %script
      window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=(r?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+e+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","resetIdentity","removeEventProperty","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
      heap.load('#{heap_app_id}');

  %body.new-theme{
    id: "{% if '/admin' in request.path %}admin-body{% endif %}",
    class: "site-wrapper {% if LANGUAGE_BIDI %}rtl{% else %}ltr{% endif %} {% if login_mode %}login{% endif %} {% if program %}with-program {% endif %} {% if request.is_IE8 %}ie8{% endif %} {% block body_class %}{% if is_full_screen %}zoomIn{% endif %}{% endblock %}",
    style: "{% if client_customization %}{%if client_customization.hex_page_background %}background-color:#{client_customization.hex_page_background};{% endif %}{%if client_customization.client_background %}background-image:url(#{client_customization.client_background});{% endif %}{%if client_customization.client_background_css%}#{client_customization.client_background_css}{% endif %}{% endif %}"
  }
    - block help_context

    -# Header
    - block header
      - include 'header.haml'

    -# Main content goes here
    %main.fadeIn.animated.delay-1s{role: "main"}
      - block navigation_content
      - block content

    -# Footer
    - block footer
      - if client_customization
        - if client_customization.is_footer_enabled
          - include 'footer.haml'
      - else
        - include 'footer.haml'

    -# jQuery-cookie
    - block jquery_cookie
      %script{src: "{% static 'js/vendor/jquery.cookie.js' %}"}

    -# jQuery-xblock
    - block jquery_xblock
      %script{src: "{% static 'js/vendor/jquery.xblock.js' %}"}

    -# Bootstrap JS
    - block bootstrap_js
      %script{src: "{% static 'js/bootstrap.bundle.min.js' %}"}

    -# JS - custom snippets
    - block js_snippets

    - block edit_full_name_modal
      .modal.middleSize.noTopBorder.fade.editProfileField#editFullName{:aria-hidden => "true", :aria-labelledby => "myLargeModalLabel", :role => "dialog", :tabindex => "-1"}
        .modal-dialog
          .modal-content
            .modal-header
              .col
                %h4.modal-title
                  {% trans "Enter your full name" %}
              %button.close{:aria-label => "Close", :data-dismiss => "modal", :type => "button"}
                %span{:aria-hidden => "true"} ×
            .modal-body
              %form.white.clearfix{action: "/accounts/edit_fullname/", method:"POST"}
                - csrf_token
                .form-group
                  %label.form-label{:for => "exampleInputEmail1"}
                    {% trans "First name" %}
                  %input.form-control.form-input{:aria-describedby => "emailHelp", :placeholder => "", :type => "text", :name => "first_name"}/
                .form-group
                  %label.form-label{:for => "exampleInputEmail1"}
                    {% trans "Last name" %}
                  %input.form-control.form-input{:aria-describedby => "emailHelp", :placeholder => "", :type => "text", :name => "last_name"}/
                .invalid-feedback.error.mb-4
                %div3
                  %button.btn.btn-primary.mt-20{:type => "submit"}
                    {% trans "Save" %}

    - block edit_title_modal
      .modal.middleSize.noTopBorder.fade.editProfileField#editRole{:aria-hidden => "true", :aria-labelledby => "myLargeModalLabel", :role => "dialog", :tabindex => "-1"}
        .modal-dialog
          .modal-content
            .modal-header
              .col
                %h4.modal-title
                  {% trans "Enter your title" %}
              %button.close{:aria-label => "Close", :data-dismiss => "modal", :type => "button"}
                %span{:aria-hidden => "true"} ×
            .modal-body
              %form.white.clearfix{:method => "POST", :action => "/accounts/edit_title/"}
                - csrf_token
                .form-group
                  %label.form-label{:for => "exampleInputEmail1"}
                    {% trans "Title" %}
                  %input.form-control.form-input{:aria-describedby => "emailHelp", :placeholder => "", :type => "text", :name => "title"}/

                .invalid-feedback.error.mb-4
                %button.btn.btn-primary.mt-10{:type => "submit"}
                  {% trans "Save" %}

    - block edit_photo_modal
      - include "accounts/user_profile.haml"

    - block general_modal
      #generalModal.modal.fade{:role => "dialog"}
        .modal-dialog
          .modal-content
            .modal-header
              %button.close{:data-dismiss => "modal", :type => "button"} ×
              %h4.modal-title.title Modal Header
            .modal-body
              %p.description Some text in the modal.
            .modal-footer
              %button.btn.btn-default{:data-dismiss => "modal", :type => "button"} Close

    - block messages_modal
      - if messages
        #messagesModal.modal.fade{:tabindex => "-1", :role => "dialog", :aria-hidden => "true"}
          .modal-dialog{:role => "document"}
            .modal-content
              .modal-header
                %button.close{:type => "button", :data-dismiss => "modal", :aria-label => "close"}
                  %span{:aria-hidden => "true"} &times;
                %h5.modal-title {% trans "Notice" %}
              .modal-body
                {% for message in messages %}
                  {{ message }}<br/>
                {% endfor %}

        %script
          if ($("#messagesModal").length){
            setTimeout(function () {
              $('#messagesModal').modal('show')
            }, 10);
          }

    -if show_new_ui_tour
      / New Feature Tour Structure
      .modal.fade.newFeatureTour.in.show{:aria-hidden => "true", :aria-labelledby => "myLargeModalLabel", :role => "dialog", :tabindex => "-1"}
        .modal-dialog.modal-lg
          .modal-content
            .modal-body
              %button.close.btn-skip{:aria-label => "Close", :data-dismiss => "modal", :type => "button"}
                %span{:aria-hidden => "true"} {% trans 'Skip'%}
              .sliderWraper

                #demo.carousel{:data-ride => "carousel", :data-touch=> "false", :data-interval=> "false", :data-keyboard=> "false", :data-pause => "hover"}

                  / The slideshow
                  .carousel-inner.nextSlide
                    .carousel-item.active.next
                      .featureImage
                        .holder
                          %img{:alt => "", :height => "", :src => "{% static 'image/newUiTour/McKA-UI-Refresh_Comm-Graphic.png' %}", :width => "600"}
                      .featureContent
                        .holder
                          .head
                            %h2 {%trans 'Your learning experience has a fresh look!' %}
                          .contentHolder
                            %p {% trans 'The new design makes it easier for you to navigate, understand your progress and stay focused on your learning.'%}
                    .carousel-item
                      .featureImage
                        .holder
                          %img{:alt => "", :height => "", :src => "{% static 'image/newUiTour/McKA-UI-Refresh_Comm-Graphic4.png' %}", :width => "600"}
                      .featureContent
                        .holder
                          .head
                            %h2 {% trans 'Navigating is simple'%}
                          .contentHolder
                            %p {% trans 'The updated landing page makes it easier for you to access your programs or courses.'%}
                    .carousel-item
                      .featureImage
                        .holder
                          %img{:alt => "", :height => "", :src => "{% static 'image/newUiTour/McKA-UI-Refresh_Comm-Graphic3.png' %}", :width => "600"}
                      .featureContent
                        .holder
                          .head
                            %h2 {% trans 'New full-screen mode'%}
                          .contentHolder
                            %p {% trans 'In your course, you can now zoom into the content by choosing full screen mode.'%}
                    .carousel-item
                      .featureImage
                        .holder
                          %img{:alt => "", :height => "", :src => "{% static 'image/newUiTour/McKA-UI-Refresh_Comm-Graphic2.png' %}", :width => "600"}
                      .featureContent
                        .holder
                          .head
                            %h2 {% trans 'Access from any device'%}
                          .contentHolder
                            %p {% trans 'The designs have been optimized for all devices so you can learn from anywhere.'%}
                    .carousel-item
                      .featureImage
                        .holder
                          %img{:alt => "", :height => "", :src => "{% static 'image/newUiTour/McKA-UI-Refresh_Comm-Graphic5.png' %}", :width => "600"}
                      .featureContent
                        .holder
                          .head
                            %h2 {% trans 'No interruption to your learning'%}
                          .contentHolder
                            %p {% trans 'Pick up where you left off! Your progress and the content in the courses is not impacted by this change.'%}

                  / Left and right controls
                  .controlsWrap
                    / Indicators
                    %ul.carousel-indicators
                      %li.active{:data-slide-to => "0", :data-target => "#demo"}
                      %li{:data-slide-to => "1", :data-target => "#demo"}
                      %li{:data-slide-to => "2", :data-target => "#demo"}
                      %li{:data-slide-to => "3", :data-target => "#demo"}
                      %li{:data-slide-to => "4", :data-target => "#demo"}
                    %a.carousel-control-prev{:data-slide => "prev", :href => "javascript:void(0)"}
                      %span.carousel-control-prev-icon
                        %i.material-icons keyboard_arrow_left
                    %a.carousel-control-next{:data-slide => "next", :href => "javascript:void(0)"}
                      %span.carousel-control-next-icon
                        %i.material-icons keyboard_arrow_right

      %script{src: "{% static 'js/new_ui_tour.js' %}"}
    %script{src: "{% static 'js/jpreLoader.min.js' %}"}

    -# Custom JS
    - block body_js

    - if xblock_theme_js_path
      %script{src: "{% static xblock_theme_js_path %}"}
    -# Session Timeout
    %script
      var apros_session_timeout_seconds = {{apros_session_timeout_seconds}};

    %script
      if (window.location.search === '?reset-password') {
          $("#password-reset-modal").modal("show");
      }
      $(document).ready(function () {
        $('body').jpreLoader();
      });
