- extends "admin/admin_layout.haml"

- load staticfiles
- block custom_js
  %script{src: "{% static 'js/vendor/tinymce/tinymce.min.js' %}"}

- block content
    #mainCourseDetailsWrapper
        .courseDetailsNavigationButton
          - if companyCourseDeatilsPage
            %a{:href => '/admin/companies/#{companyId}', :target => '_self'}>
              < Back to ={companyName}
          - else
            %a{:href => '/admin/courses/', :target => '_self'}> < Back to All Courses
        #courseDetailsDataWrapper{:data-id => '#{id}', :data-name => '#{name}', :admin-flag => '#{companyAdminFlag}', :company-page => '#{companyCourseDeatilsPage}', :company-id => '#{companyId}', :internal-flag => '#{internalAdminFlag}'}
            #courseDetailsTopContainer
                .row.courseDetailsHeader
                    .courseDetailsNameAndId
                      ={name}
                      ={id}
                    .courseDetailsTags
                      - for tag in tags
                        - if user.is_company_admin
                          .courseDetailsTagsListCompAdmin.button.small.radius{:data-id => '#{tag.id}'}
                            %span ={tag.name}
                        - else
                          .courseDetailsTagsList.button.small.radius{:data-id => '#{tag.id}'}
                            %span ={tag.name}
                            %i.fa.fa-times.courseTagsDeleteIcon
                      - if user.is_company_admin
                      - else
                        %i.fa.fa-pencil.courseTagsIcon
                .row.courseDetailsBlocks
                    .large-4.columns.courseDetailsLeftBlock
                      - if start == '-' or end == '-'
                        %p Evergreen
                      - else
                        %p ={start} - ={end}
                      %p Participants: ={users_enrolled}
                    .large-4.columns.courseDetailsCenterBlock
                      %p Avg Progress: ={average_progress}%
                      %p Avg Proficiency: ={proficiency}
                    .large-4.columns.courseDetailsRightBlock
                      %p Completed: ={completed}%
                      %p Passed: ={passed}%
            #courseMainDetailsContainerView
              .courseDetailsMenuButtons.row
                .courseParticipantsButton.large-2.columns
                  %a{:href => '#', :target => '_self', :data-target => 'courseParticipants', :data-container => '#courseDetailsMainContainer', :onclick => 'Apros.Router.HashPageChanger(this)'}>  PARTICIPANTS
                .courseStatsButton.large-2.columns
                  %a{:href => '#', :target => '_self', :data-target => 'courseStats', :data-container => '#courseDetailsMainContainer', :onclick => 'Apros.Router.HashPageChanger(this)'}>  STATS
                - if request.resolver_match.url_name == 'course_details'
                  .courseStatsButton.large-4.columns
                    %a{:href => 'learner_dashboard'}>  LEARNER DASHBOARD

                  .courseStatsButton.large-4.columns
                    - if certificates_status == certificates_statuses.available
                      %form#generate-certificate-form{action: "{% url 'generate_course_certificates' id %}", method: 'POST'}
                        - csrf_token
                        %input{type: 'hidden', name: 'course_end', value: '{{end}}'}
                        %button.generateCourseCertButton{type: 'submit'}>  Generate Certificates
                    - elif certificates_status == certificates_statuses.generating
                       %button.generateCourseCertButton.disabled  Generating Certificates
                    - elif certificates_status == certificates_statuses.generated
                       %button.generateCourseCertButton.disabled  Certificates Generated
                %hr
            #courseDetailsMainContainer
              .row.courseParticipants.contentNavigationContainer
                - if user.is_company_admin
                - else
                  #courseBulkActionsMainContainer.bulkActionsButtonContainer.disabled
                    .bulkButtonWrapper
                      .hiddenButtonSplitModifier.bulkButton.disabled
                      - if user.is_internal_admin
                        %a.bulkEmailSelectedParticipantsInternal.button.disabled{:href => "#"}
                          Email Selected Participants
                      - else
                        %a.bulkEmailSelectedParticipants.button.bulkButton.disabled{:href => "#"}
                          Email Selected Participants
                      %a.button.bulkDropdownIcon.bulkButton.disabled
                        .fa.fa-chevron-down
                    #dropBulkCourse.f-dropdown{:style => 'display: none',:aria-hidden => "true"}
                      %a.button.submenuButtons.bulkChangeStatus.bulkButton.disabled{:href => "#"} Change status
                      %a.button.submenuButtons.bulkUnenrollFromCourse.bulkButton.disabled{:href => "#"} Unenroll from course
                      %a.button.submenuButtons.bulkEnrollInNewCourse.bulkButton.disabled{:href => "#"} Enroll in new course
                      %a.button.submenuButtons.bulkExportStats.bulkButton.disabled{:href => "#"} Export stats
                      %a.button.submenuButtons.bulkExportNotifData.bulkButton.disabled{:href => "#"} Download CSV For Notifications
                #courseDetailsParticipantsGridWrapper
                  #courseDetailsParticipantsGrid.large-12.columns
              .row.courseStats.contentNavigationContainer
                #courseDetailsEngagementTopic.courseDetailsTopic
                  Engagement Summary
                #coursesDownloadStatsButton
                  - if companyCourseDeatilsPage
                    %a.button.radius.small{:href => '/admin/courses/#{id}/download_course_stats/?company_id=#{companyId}', :target => '_self'}> Export Stats
                  - else
                    %a.button.radius.small{:href => '/admin/courses/#{id}/download_course_stats/', :target => '_self'}> Export Stats
                #courseDetailsEngagementViewGrid.courseDetailsViewGrid.large-12.columns
                #courseDetailsPerformanceTopic.courseDetailsTopic
                  Participant Performance
                #courseDetailsPerformanceViewGrid.courseDetailsViewGrid.large-12.columns
                #courseDetailsStatsTopic.courseDetailsTopic
                  Social Engagement
                #courseDetailsStatsViewGrid.courseDetailsViewGrid.large-12.columns
                #courseDetailsTimelineTopic.courseDetailsTopic
                  Cohort Timeline
                #course-details-timeline-wrapper
                  %svg#course-details-timeline
  #courseDetailsMainModal.reveal-modal.small{"aria-hidden" => "true", "aria-labelledby" => "modalTitle", "data-reveal" => "", :role => "dialog"}
    %h2.courseModalTitle
    %i.fa.fa-spinner.fa-spin.loadingIcon.hidden
    .courseModalStatus
    %hr
    .courseModalDescription
    .courseModalContent
    .courseModalControl
      .button.saveChanges
        Save Changes
      %a.cancelChanges{:href => "#"} Cancel
    %a.close-reveal-modal{"aria-label" => "Close"}
      &#215;
  #courseDetailsBulkEmail.reveal-modal.medium{"aria-hidden" => "true", "data-reveal" => "", :role => "dialog"}
    %h2.emailModalTitle
    %i.fa.fa-spinner.fa-spin.loadingIcon.hidden
    .emailModalStatus
    %hr
    .row
      .large-12.columns.courseModalDescription
        Email selected participants
    .emailModalContent
      .row
        .large-6.columns.participantFirstName
          .fromEmailLabel.labelUniversal
            From
          .fromEmailValue
            %input{:type => "text", :value => '', :name => "from_email", :maxlength => "128"}
        .large-6.columns.participantLastName
          .templateNameLabel.labelUniversal
            Template
          .templateControlButtons
            %i.fa.fa-floppy-o.saveAsNewTemplate{:data-title => "Save as new template"}
            %i.fa.fa-pencil-square-o.updateTemplate{:data-title => "Update selected template"}
            %i.fa.fa-trash-o.removeTemplate{:data-title => "Remove selected template"}
          .templateNameValue
            %select{:name => 'template_id'}
              %option{:value => "none"} None
              - for template in template_list
                %option{:value => "#{template.pk}"}
                  =template.title
      .row
        .large-12.columns.emailSubject
          .emailSubjectLabel.labelUniversal
            Subject
          .emailSubjectValue
            %input{:type => "text", :value => '', :name => "subject", :maxlength => "256"}
      .row
        .large-12.columns.emailBody
          .emailBodyLabel.labelUniversal
            Body
          .emailBodyTextarea
            %textarea#email_editor
    .row
      .large-12.columns.emailModalControl
        .button.sendEmail
          Send Email
        .buttonBlock
          %a.previewEmail{:href => "#"} Preview email
          %a.scheduleForLater{:href => "#"} Schedule for Later

    %a.close-reveal-modal{"aria-label" => "Close"}
      &#215;


  #courseTagsModal.reveal-modal.small{"aria-hidden" => "true", "aria-labelledby" => "modalTitle", "data-reveal" => "", :role => "dialog"}
    %h2 Add Tags to this Course
    %hr
    .row
      .large-6.columns
        .courseTagsList
          %input.courseTagsInput{:type => "text", :value => '', :name => "tag_name" }
          .errorMessage
          .newTagCreationPopup
            Since this tag does not yet exist, a new Tag will be created. If this is an error, try selecting your tag from the type-ahead results.
    .row.courseTagsModalControl
      .button.addTagButton.small.radius
        Save
      %a.closeModal{:href => "#"} Cancel
    %a.close-reveal-modal{"aria-label" => "Close"}
      &#215;


  #tagCoursesListModal.reveal-modal.tiny{"aria-hidden" => "true", "aria-labelledby" => "modalTitle", "data-reveal" => "", :role => "dialog"}
    %h2.tagCoursesListTitle
    %hr
    .row
      #tagCoursesListBlock
    %a.close-reveal-modal{"aria-label" => "Close"}
      &#215;

  - include "admin/fragments/hidden_image_upload_form.haml"
- block js_snippets
  :javascript

    var course_details_count_all_users = '{{count}}';
