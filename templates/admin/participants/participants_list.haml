- extends "admin/admin_layout.haml"
- load i18n

- block content
  #mainParticipantsWrapper
    #participantsListTopContainer{:internal-flag => '#{internalAdminFlag}'}
      #participantsAddWrapper
        %input.button.small.radius.menuButton.participantAddButton{:type => "button", :value => "{% trans 'Add New Participant' %}"}
        %input.button.small.radius.menuButton{:type => "button", :value => "{% trans 'Enroll Existing Participants' %}", 'data-reveal-id': 'enroll_to_course_from_csv'}
        %input.button.small.radius.menuButton{:type => "button", :value => "{% trans 'Import from CSV' %}", 'data-reveal-id': 'import_from_csv'}
        %input.button.small.radius.menuButton{:type => "button", :value => "{% trans 'Update profile data' %}", 'data-reveal-id': 'update_profile_data'}
        %input.button.small.radius.menuButton{:type => "button", :value => "{% trans 'Update manager data' %}", 'data-reveal-id': 'update_manager_data'}
        %a.button.small.radius.menuButton{:href => "{% url 'participants_import_progress' %}"}
          {% trans "Import Progress" %}
        %input.button.small.radius.secondary.menuButton{:type => "button", :value => "{% trans 'CSV Template' %}", 'data-reveal-id': 'download_csv_template'}
      %hr
      #participantsSearchWrapper
        .row
          .large-3.columns
            %input{:placeholder => '{% trans "Company" %}', :type => 'text', :name => 'organization_display_name', :class => 'clearableParticipantsList'}
          .large-3.columns
            %input{:placeholder => '{% trans "Course" %}', :type => 'text', :name => 'courses', :class => 'clearableParticipantsList'}
          .large-3.columns
            %input{:placeholder => '{% trans "Name" %}', :type => 'text', :name => 'name', :class => 'clearableParticipantsList'}
          .large-3.columns
            %input{:placeholder => '{% trans "Email" %}', :type => 'text', :name => 'email', :class => 'clearableParticipantsList'}

    #participantsListViewGridBlock

    - if enableDataDeletion
      #delete_user_modal.reveal-modal.small{'data-reveal': ''}
        .close-reveal-modal
          %i.fa.fa-times-circle
        .titleContainer
          %h2 {% trans "Delete User Data" %}
        %hr
        .contentContainer
          {% trans "Please note that the data is deleted permanently and you will lose all the data about this user." %}
          %br
          %br
          .boldText
            {% trans "Are you sure you want to delete this user?" %}
        .errorContainer
        .button-wrapper
          %a.button.small.radius.menuButton.close-reveal-modal.close-modal-inline{:type => "button", :value => "Cancel"}
            {% trans "Cancel" %}
          %a.button.small.radius.menuButton.confirmButton{:type => "button"}
            {% trans "Yes" %}

      #delete_user_success.reveal-modal.small{'data-reveal': ''}
        .close-reveal-modal
          %i.fa.fa-times-circle
        .titleContainer
          %h2 {% trans "Successfully deleted user!" %}
        .button-wrapper.topPadding
          %a.button.small.radius.menuButton.close-reveal-modal.close-modal-inline{:type => "button", :value => "I'm Done"}
            {% trans "I'm Done" %}

    #add_a_participant.reveal-modal.small{'data-reveal': ''}
      .close-reveal-modal
        %i.fa.fa-times-circle
      %h2 {% trans "Add a Participant" %}
      %p
        {% trans "Want to add more than one participant at a time?" %}
        %a{:href => "#", 'data-reveal-id': 'import_from_csv'}
          {% trans "Import a list" %}

      %hr
      .errorContainer
      %form.participantDetailsEditForm
        - csrf_token
        .row
          .large-6.columns.participantFirstName
            .participantFirstNameLabel.labelUniversal
              {% blocktrans %} First Name<sup>*</sup> {% endblocktrans %}
            .participantFirstNameValue
              %input.cleanable{:type => "text",  :name => "first_name", :maxlength => "30"}
          .large-6.columns.participantLastName
            .participantLastNameLabel.labelUniversal
              {% blocktrans %}Last Name<sup>*</sup> {% endblocktrans %}
            .participantLastNameValue
              %input.cleanable{:type => "text",  :name => "last_name", :maxlength => "30"}
        .row
          .large-6.columns.participantEmail
            .participantEmailLabelContainer.labelUniversal
              .participantEmailLabel.inlineBlock
                {% blocktrans %} Email<sup>*</sup> {% endblocktrans %}
            .participantEmailValue
              %input.cleanable{:type => "email", :name => "email", :maxlength => "60", :onkeyup => 'validateParticipantEmail()', :class => 'participantEmailInput', :required => 'true'}
              %i.fa.fa-check-circle-o.correctInput.checkMark
          .large-6.columns.participantCompany
            .participantCompanyLabel.labelUniversal
              {% blocktrans %} Company<sup>*</sup> {% endblocktrans %}
            .participantCompanyValue
              %input.cleanable{:type => "text", :name => "company", :maxlength => "60"}
              %i.fa.fa-check-circle-o.correctInput
              .newCompanyCreationPopup
                {% trans "Since this company does not yet exist, a new company will be created. If this is an error, try selecting your company from the type-ahead results." %}
              .errorMessage
        .row
          .large-6.columns.participantCountry
            .participantCountryLabel.labelUniversal
              {% trans "Country Abbreviation" %}
            .participantCountryValue
              %input{:type => "text", :id =>'country_edit', :name => "country_fullname", :readonly => '', :maxlength => "2"}
              %input{:type => "hidden", :id =>'country_edit_code', :name => "country", :maxlength => "2"}
          .large-6.columns.participantCity
            .participantCityLabel.labelUniversal
              {% trans "City" %}
            .participantCityValue
              %input.cleanable{:type => "text", :name => "city", :maxlength => "60"}
        .row        
          .large-6.columns.participantGender
            .participantGenderLabel.labelUniversal
              {% trans "Gender" %}
            .participantGenderValue
              %select{:name => "gender"}
                  %option{:value => ""}
                    {% trans "N/A" %}
                  %option{:value => "M"}
                    {% trans "Male" %}
                  %option{:value => "F"}
                    {% trans "Female" %}
          .large-6.columns.participantPermissions
            .participantPermissionsLabel.labelUniversal
              {% trans "Permissions" %}
            .participantPermissionsValue
              %select{:name => "company_permissions"}
                %option{:value => "none"}
                  {% trans "None" %}
                - if user.is_mcka_admin
                  %option{:value => "uber_admin"}
                    {% trans "Uber admin" %}
                - if user.is_mcka_admin or user.is_mcka_subadmin
                  %option{:value => "course_ops"}
                    {% trans "Course ops admin" %}
                %option{:value => "internal_admin"}
                  {% trans "Internal Admin" %}
        %hr
        .adminAnotherCompanyAllWrapper
        - if user.is_mcka_admin or user.is_mcka_subadmin
          .addAnotherCompanyWrapper.row
            %a.large-12.columns
              + {% trans "Add company admin privileges" %}
          %hr
        .adminCourseAllWrapper
        - if user.is_mcka_admin or user.is_mcka_subadmin or user.is_internal_admin
          .addAnotherCourseWrapper.row
            %a.large-12.columns
              + {% trans "Add course" %}
          %hr
        .emailActivationWrapper.row
          .large-12.columns
            .emailActivationLinkCheckboxWrapper
              %input.emailActivationCheckbox{:type => 'checkbox'}
              .emailActivation
                {% trans "Email activation link now" %}
      .button-wrapper
        %a.button.small.radius.menuButton.addSingleParticipantButton{:type => "button", :value => "Add Participant"}
          {% trans "Add Participant" %}
        %a.button.small.radius.menuButton.close-reveal-modal.close-modal-inline{:type => "button", :value => "Cancel"}
          {% trans "Cancel" %}
    
    #download_csv_template.reveal-modal.small{'data-reveal': ''}
      .close-reveal-modal
        %i.fa.fa-times-circle
      %h2 {% trans "CSV Template and Formatting" %}
      %p 
        {% trans "Download the CSV template below to import users." %}
        %strong {% trans "All fields in the template are required." %}
        {% trans "Note that you must add users to preexisting companies and courses." %}
      .button-wrapper
        %a.button.small.radius.menuButton{:type => "button", :value => "Download Template", :href => '/static/docs/participant-onboarding-template.csv', :target => '_blank'}
          {% trans "Download Template" %}
        %a.button.small.radius.menuButton.close-reveal-modal.close-modal-inline{:type => "button", :value => "Cancel"}
          {% trans "Cancel" %}

    #import_from_csv.reveal-modal.medium{'data-reveal': ''}
      .close-reveal-modal
        %i.fa.fa-times-circle
      %h2 {% trans "Import Participants from CSV" %}
      %hr
      .bottomPadding
        %a{:href => "#", 'data-reveal-id': 'download_csv_template'} CSV Template
      .admin-form

        %form{action: "/admin/api/participants/import_participants", method: "POST", enctype: "multipart/form-data"}
          - csrf_token
          = form
          
          .button-wrapper.topPadding
            %input.button.radius.small{type: "submit", value: "{% trans 'Add Participants' %}", disabled: "disabled", id: ''}
            %a.button.small.radius.menuButton.close-reveal-modal.close-modal-inline{:type => "button", :value => "Cancel"}
              {% trans "Cancel" %}

        %form{action: "/admin/api/participants/import_participants", method: "POST", enctype: "multipart/form-data", :class => "dropzone", :id => 'participantsCsvUpload'}

        .upload_stats
        #enroll-error-list

        .emailActivationWrapper
            .emailActivationLinkCheckboxWrapper
              %input.emailActivationCheckbox{:type => 'checkbox', :disabled => 'disabled', :id => 'emailActivationCheckboxId'}
              %label.emailActivation{:for => 'emailActivationCheckboxId' }
                {% trans "Email activation links now" %}

    #import_participants_popup_message.reveal-modal.tiny{:aria-hidden => "true", :aria-labelledby => "modalTitle", :data-reveal => "", :role => "dialog"}
      %h2#modalTitle {% trans "Your CSV is Importing..." %}
      %p.lead
        {% blocktrans %} Import will run in the background. You may access the status from the
        %span
          'Import Progress'
        tab.
        {% endblocktrans %}
      %a.close-reveal-modal.button{:aria-label => "Close"} {% trans "Okay" %}
      %a.close-reveal-modal{:aria-label => "Close"} ×

    #enroll_to_course_from_csv.reveal-modal.medium{'data-reveal': ''}
      .close-reveal-modal
        %i.fa.fa-times-circle
      %h2 {% trans "Enroll Participants to courses from CSV" %}
      %hr
      .bottomPadding
        %a#enrollParticipantTemplate{:href => "#", 'download': 'template.csv'}
          {% trans "CSV Template" %}
      .admin-form{style: "padding-bottom:0px;"}

        %form{action: "/admin/api/participants/enroll_participants_from_csv", method: "POST", enctype: "multipart/form-data", :class => "fileInputEnroll"}
          - csrf_token
          = form_enroll

        %form{action: "/admin/api/participants/enroll_participants_from_csv", method: "POST", enctype: "multipart/form-data", :class => "dropzone", :id => 'participantsEnrollCsvUpload'}

        .upload_stats
        .button-wrapper.topPadding{style: "padding-top:10px;padding-bottom:10px;position:relative;"}
            %input.button.radius.small{type: "submit", value: "{% trans 'Add Participants' %}", disabled: "disabled", id: 'submitCSVEnroll'}
            %a.button.small.radius.menuButton.close-reveal-modal.close-modal-inline{:type => "button", :value => "Cancel"}
              {% trans "Cancel" %}
            %i.fa.fa-spin.fa-spinner{style: "display:none;"}
        #enroll-participants-error-list




    #confirmation_screen.reveal-modal.big{'data-reveal': '', 'data-task-key': '', 'data-uploaded': ''}
      .close-reveal-modal
        %i.fa.fa-times-circle
      %h2.upload_message
      %hr

      .downloadActivationLinksConfirmationScreen
        %p {% trans "You can download the activation links now, or from the participant profiles at any time." %}
        %br
        %a.download_activation{:href => '/admin/api/participants/import_participants/download_activation_links/?task_key=', :target => '_self'}>
          {% trans "Download Activation Links" %}

      .sendActivationLinksConfirmationScreen
        %p {% trans "An activation link has been emailed to each student." %}

      .button-wrapper.topPadding
        %a.button.small.radius.menuButton.close-reveal-modal.close-modal-inline{:type => "button", :value => "I'm Done"}
          {% trans "I'm Done" %}

    #confirmation_screen_single_participant.reveal-modal.big{'data-reveal': ''}
      .close-reveal-modal
        %i.fa.fa-times-circle
      %h2.upload_message
        {% trans "Successfully added new user!" %}
      %hr

      %p {% trans "You can download the activation link now, or from the participant profiles at any time." %}
      %br
      %br
      %a.download_user_activation{:data-url => '/admin/api/participants/import_participants/download_activation_links/?user_id=', :target => '_self'}>
        {% trans "Download Activation Link" %}
      %br
      %a.go_to_user_profile{:data-url => '/admin/participants/', :target => '_self'}>
        {% trans "Go To User Profile" %}

      .button-wrapper.topPadding
        %a.button.small.radius.menuButton.close-reveal-modal.close-modal-inline{:type => "button", :value => "I'm Done"}
          {% trans "I'm Done" %}

  #update_manager_data.reveal-modal.medium{'data-reveal': ''}
    .close-reveal-modal
      %i.fa.fa-times-circle
    %h2 {% trans "Update manager info of participants from CSV" %}
    %hr
    .bottomPadding
      %a#managerUpdateDownload{:href => "#", 'download': 'template.csv'}
        {% trans "CSV Template" %}
    .admin-form{style: "padding-bottom:0px;"}

      %form{action: "/admin/api/participants/update_manager_from_csv$", method: "POST", enctype: "multipart/form-data", :class => "fileInputManager"}
        - csrf_token
        = form_manager_update

      %form{action: "/admin/api/participants/update_manager_from_csv$", method: "POST", enctype: "multipart/form-data", :class => "dropzone", :id => 'participantsManagerUpdate'}
        - csrf_token

      .upload_stats
      .button-wrapper.topPadding{style: "padding-top:10px;padding-bottom:10px;position:relative;"}
        %input.button.radius.small{type: "submit", value: "{% trans 'Add Participants' %}", id: 'submitManagerUpdate'}
        %a.button.small.radius.menuButton.close-reveal-modal.close-modal-inline{:type => "button", :value => "Cancel"}
          {% trans "Cancel" %}
        %i.fa.fa-spin.fa-spinner{style: "display:none;"}


  #update_profile_data.reveal-modal.medium{'data-reveal': ''}
    .close-reveal-modal
      %i.fa.fa-times-circle
    %h2 {% trans "Update organization fields of participants from CSV" %}
    %hr
    .bottomPadding
      %a#companyFieldUpdateDownload{:href => "#", 'download': 'template.csv'}
        {% trans "CSV Template" %}
    .admin-form{style: "padding-bottom:0px;"}

      %form{action: "/admin/api/participants/update_company_fields_from_csv$", method: "POST", enctype: "multipart/form-data", :class => "fileInputCompanyField"}
        - csrf_token
        = form_company_fields

      %form{action: "/admin/api/participants/update_company_fields_from_csv$", method: "POST", enctype: "multipart/form-data", :class => "dropzone", :id => 'participantsProfileUpdate'}
        - csrf_token

      .upload_stats
      .button-wrapper.topPadding{style: "padding-top:10px;padding-bottom:10px;position:relative;"}
        %input.button.radius.small{type: "submit", value: "{% trans 'Add Participants' %}", id: 'submitCompanyFieldsUpdate'}
        %a.button.small.radius.menuButton.close-reveal-modal.close-modal-inline{:type => "button", :value => "Cancel"}
          {% trans "Cancel" %}
        %i.fa.fa-spin.fa-spinner{style: "display:none;"}

  #participantUpdateStatus.reveal-modal.small{"data-reveal": ""}
    %p.mainText
    %a.close-reveal-modal#closeParticipantUpdateStatus{"aria-label": "Close"}
      &#215;


- block js_snippets
  :javascript
    var enable_data_deletion = '{{enableDataDeletion}}';
